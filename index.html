<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sázkařský Deník PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">

    <div class="max-w-6xl mx-auto p-4 md:p-8">
        <!-- Header -->
        <header class="mb-8 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div>
                <h1 class="text-3xl font-black text-slate-800 flex items-center gap-3">
                    <i data-lucide="trophy" class="text-amber-500 w-8 h-8"></i> Sázkařský Deník
                </h1>
                <p class="text-slate-500 font-medium">Sledujte své výsledky a optimalizujte strategii</p>
            </div>
            <button id="exportBtn" class="flex items-center gap-2 bg-white border border-slate-200 px-5 py-2.5 rounded-xl text-sm font-bold hover:bg-slate-100 transition-all shadow-sm active:scale-95 text-slate-700">
                <i data-lucide="save" class="w-4 h-4 text-blue-600"></i> Exportovat data do kódu
            </button>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Form Section -->
            <div class="lg:col-span-1 space-y-6">
                <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                    <h2 class="text-xl font-bold mb-5 flex items-center gap-2 text-slate-800">
                        <i data-lucide="activity" class="w-5 h-5 text-blue-600"></i> Nový záznam
                    </h2>
                    <form id="betForm" class="space-y-4">
                        <div>
                            <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1.5 ml-1">Druh sportu</label>
                            <select id="sport" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 outline-none focus:ring-2 focus:ring-blue-500 font-medium appearance-none">
                                <!-- Vyplněno JS -->
                            </select>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1.5 ml-1">Vklad (Kč)</label>
                                <input type="text" inputmode="decimal" id="stake" placeholder="Např. 500" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 outline-none focus:ring-2 focus:ring-blue-500 font-bold" required>
                            </div>
                            <div>
                                <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1.5 ml-1">Kurz</label>
                                <input type="text" inputmode="decimal" id="odds" placeholder="1.85" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 outline-none focus:ring-2 focus:ring-blue-500 font-bold" required>
                            </div>
                        </div>

                        <div>
                            <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1.5 ml-1">Výsledek tiketu</label>
                            <div class="grid grid-cols-3 gap-2" id="statusGroup">
                                <button type="button" data-status="win" class="status-btn py-2.5 rounded-xl text-[11px] font-black uppercase transition-all bg-green-600 text-white shadow-lg shadow-green-100">Výhra</button>
                                <button type="button" data-status="loss" class="status-btn py-2.5 rounded-xl text-[11px] font-black uppercase transition-all bg-slate-100 text-slate-500 hover:bg-slate-200">Prohra</button>
                                <button type="button" data-status="cashout" class="status-btn py-2.5 rounded-xl text-[11px] font-black uppercase transition-all bg-slate-100 text-slate-500 hover:bg-slate-200">Cashout</button>
                            </div>
                        </div>

                        <div>
                            <label id="winLabel" class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1.5 ml-1">Skutečně vyplaceno (Kč)</label>
                            <input type="text" inputmode="decimal" id="winAmount" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 outline-none focus:ring-2 focus:ring-blue-500 font-bold text-slate-700">
                        </div>

                        <div>
                            <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-1.5 ml-1">Datum sázky</label>
                            <input type="date" id="date" class="w-full bg-slate-50 border border-slate-200 rounded-xl p-3 outline-none focus:ring-2 focus:ring-blue-500 font-medium">
                        </div>

                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-black py-4 rounded-2xl transition-all shadow-xl shadow-blue-200 active:scale-95 mt-2 uppercase tracking-widest text-sm">
                            Přidat do historie
                        </button>
                    </form>
                </div>
            </div>

            <!-- Stats & History Section -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Summary Cards -->
                <div id="statsSummary" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>

                <!-- Analysis Modules -->
                <div id="analysisGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6 hidden">
                    <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                        <h3 class="font-black text-xs mb-5 flex items-center gap-2 uppercase tracking-widest text-slate-400">
                            <i data-lucide="target" class="w-4 h-4 text-purple-600"></i> Analýza kurzů
                        </h3>
                        <div id="oddsAnalysis" class="flex justify-between items-end">
                            <!-- JS -->
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-200">
                        <h3 class="font-black text-xs mb-5 flex items-center gap-2 uppercase tracking-widest text-slate-400">
                            <i data-lucide="bar-chart-3" class="w-4 h-4 text-green-600"></i> Výkonnost sportů
                        </h3>
                        <div id="sportStats" class="space-y-3 max-h-32 overflow-y-auto pr-2 custom-scrollbar">
                            <!-- JS -->
                        </div>
                    </div>
                </div>

                <!-- History Table -->
                <div class="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-6 border-b border-slate-100 flex justify-between items-center">
                        <h3 class="font-black text-slate-800 uppercase tracking-widest text-sm">Poslední tikety</h3>
                        <span class="text-[10px] font-black bg-slate-100 text-slate-500 px-3 py-1 rounded-full uppercase tracking-widest">Live historie</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 border-b border-slate-100">
                                <tr>
                                    <th class="px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest">Sport / Datum</th>
                                    <th class="px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest">Vklad / Kurz</th>
                                    <th class="px-6 py-4 text-[10px] font-black text-slate-400 uppercase tracking-widest">Bilance</th>
                                    <th class="px-6 py-4 text-right"></th>
                                </tr>
                            </thead>
                            <tbody id="betsTableBody" class="divide-y divide-slate-100"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="msgBox" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-6 py-3 rounded-2xl shadow-2xl opacity-0 transition-opacity pointer-events-none z-50 text-sm font-bold"></div>

    <script>
        const SPORTS = ["Fotbal", "Hokej", "Tenis", "Basketbal", "Házená", "Volejbal", "Baseball", "MMA", "Box", "Americký fotbal", "Šipky", "Esport (CS2)", "Esport (LoL)", "Esport (Dota 2)", "Ostatní"];
        let bets = JSON.parse(localStorage.getItem('betting_history')) || [];
        let currentStatus = 'win';

        function init() {
            renderSportOptions();
            setupEventListeners();
            updateUI();
            lucide.createIcons();
        }

        function renderSportOptions() {
            const select = document.getElementById('sport');
            SPORTS.forEach(s => {
                const opt = document.createElement('option');
                opt.value = s;
                opt.textContent = s;
                select.appendChild(opt);
            });
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
        }

        function parseInput(val) {
            if (!val) return 0;
            return parseFloat(val.toString().replace(',', '.'));
        }

        function setupEventListeners() {
            const statusBtns = document.querySelectorAll('.status-btn');
            statusBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    currentStatus = btn.dataset.status;
                    statusBtns.forEach(b => {
                        b.classList.remove('bg-green-600', 'bg-red-600', 'bg-amber-500', 'text-white', 'shadow-lg');
                        b.classList.add('bg-slate-100', 'text-slate-500');
                    });
                    
                    const colorClass = currentStatus === 'win' ? 'bg-green-600' : currentStatus === 'loss' ? 'bg-red-600' : 'bg-amber-500';
                    btn.classList.add(colorClass, 'text-white', 'shadow-lg');
                    btn.classList.remove('bg-slate-100', 'text-slate-500');

                    const winInput = document.getElementById('winAmount');
                    const winLabel = document.getElementById('winLabel');
                    
                    if (currentStatus === 'loss') {
                        winInput.disabled = true;
                        winInput.value = '0';
                        winLabel.textContent = 'Ztráta (Kč)';
                    } else {
                        winInput.disabled = false;
                        winLabel.textContent = 'Skutečně vyplaceno (Kč)';
                        autoCalculateWin();
                    }
                });
            });

            ['stake', 'odds'].forEach(id => {
                document.getElementById(id).addEventListener('input', autoCalculateWin);
            });

            document.getElementById('betForm').addEventListener('submit', (e) => {
                e.preventDefault();
                const stake = parseInput(document.getElementById('stake').value);
                const odds = parseInput(document.getElementById('odds').value);
                const winAmount = parseInput(document.getElementById('winAmount').value);
                
                if (isNaN(stake) || stake <= 0) {
                    showMsg('Zadejte platný vklad');
                    return;
                }

                const newBet = {
                    id: Date.now(),
                    sport: document.getElementById('sport').value,
                    stake,
                    odds: odds || 1,
                    status: currentStatus,
                    winAmount: currentStatus === 'loss' ? 0 : winAmount,
                    date: document.getElementById('date').value
                };

                bets = [newBet, ...bets];
                saveAndRefresh();
                e.target.reset();
                document.getElementById('date').value = new Date().toISOString().split('T')[0];
                statusBtns[0].click();
                showMsg('Tiket přidán');
            });

            document.getElementById('exportBtn').addEventListener('click', () => {
                const dataStr = JSON.stringify(bets, null, 2);
                const textArea = document.createElement("textarea");
                textArea.value = dataStr;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showMsg('Data zkopírována! Můžete je vložit do kódu.');
            });
        }

        function autoCalculateWin() {
            if (currentStatus === 'win') {
                const stake = parseInput(document.getElementById('stake').value);
                const odds = parseInput(document.getElementById('odds').value);
                if (stake && odds) {
                    document.getElementById('winAmount').value = (stake * odds).toFixed(2).replace('.', ',');
                }
            }
        }

        function saveAndRefresh() {
            localStorage.setItem('betting_history', JSON.stringify(bets));
            updateUI();
        }

        function deleteBet(id) {
            if(confirm('Smazat tento tiket?')) {
                bets = bets.filter(b => b.id !== id);
                saveAndRefresh();
            }
        }

        function updateUI() {
            const tableBody = document.getElementById('betsTableBody');
            tableBody.innerHTML = '';

            if (bets.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="4" class="px-6 py-12 text-center text-slate-400 font-medium italic">Zatím žádné záznamy.</td></tr>';
                document.getElementById('statsSummary').innerHTML = '';
                document.getElementById('analysisGrid').classList.add('hidden');
                return;
            }

            document.getElementById('analysisGrid').classList.remove('hidden');

            // --- VÝPOČTY STATISTIK ---
            const totalStaked = bets.reduce((sum, b) => sum + b.stake, 0);
            const totalReturned = bets.reduce((sum, b) => (b.status !== 'loss' ? sum + b.winAmount : sum), 0);
            const profit = totalReturned - totalStaked;
            const roi = (profit / totalStaked) * 100;
            const winRate = (bets.filter(b => b.status === 'win').length / bets.length) * 100;

            // Karty přehledu
            document.getElementById('statsSummary').innerHTML = `
                <div class="bg-white p-5 rounded-3xl border border-slate-200">
                    <p class="text-[10px] text-slate-400 font-black uppercase mb-1">Profit</p>
                    <p class="text-2xl font-black ${profit >= 0 ? 'text-green-600' : 'text-red-600'}">
                        ${profit.toLocaleString()} Kč
                    </p>
                </div>
                <div class="bg-white p-5 rounded-3xl border border-slate-200">
                    <p class="text-[10px] text-slate-400 font-black uppercase mb-1">ROI</p>
                    <p class="text-2xl font-black ${roi >= 0 ? 'text-blue-600' : 'text-red-600'}">${roi.toFixed(1)}%</p>
                </div>
                <div class="bg-white p-5 rounded-3xl border border-slate-200">
                    <p class="text-[10px] text-slate-400 font-black uppercase mb-1">Win Rate</p>
                    <p class="text-2xl font-black text-slate-800">${winRate.toFixed(1)}%</p>
                </div>
                <div class="bg-white p-5 rounded-3xl border border-slate-200">
                    <p class="text-[10px] text-slate-400 font-black uppercase mb-1">Tikety</p>
                    <p class="text-2xl font-black text-slate-800">${bets.length}</p>
                </div>
            `;

            // Analýza kurzů
            const oddsBuckets = bets.reduce((acc, b) => {
                const bucket = Math.floor(b.odds * 2) / 2;
                if (!acc[bucket]) acc[bucket] = { count: 0, wins: 0 };
                acc[bucket].count++;
                if (b.status === 'win') acc[bucket].wins++;
                return acc;
            }, {});

            let mostCommon = { odds: 0, count: 0, wins: 0 };
            Object.entries(oddsBuckets).forEach(([odd, data]) => {
                if (data.count > mostCommon.count) mostCommon = { odds: odd, ...data };
            });

            document.getElementById('oddsAnalysis').innerHTML = `
                <div>
                    <span class="text-4xl font-black text-slate-800">${mostCommon.odds}</span>
                    <span class="text-slate-400 font-bold ml-2 text-sm uppercase">nejčastější kurz</span>
                </div>
                <div class="text-right">
                    <div class="text-green-600 text-xl font-black">${((mostCommon.wins / mostCommon.count) * 100).toFixed(1)}%</div>
                    <div class="text-[10px] text-slate-400 font-black uppercase">Úspěšnost v této hladině</div>
                </div>
            `;

            // Výkonnost sportů
            const sportAnalysis = bets.reduce((acc, b) => {
                if (!acc[b.sport]) acc[b.sport] = { count: 0, wins: 0, profit: 0 };
                acc[b.sport].count++;
                const bProfit = (b.status !== 'loss' ? b.winAmount : 0) - b.stake;
                acc[b.sport].profit += bProfit;
                if (b.status === 'win') acc[b.sport].wins++;
                return acc;
            }, {});

            const sortedSports = Object.entries(sportAnalysis).sort((a,b) => b[1].profit - a[1].profit);
            document.getElementById('sportStats').innerHTML = sortedSports.map(([sport, data]) => `
                <div class="flex justify-between items-center text-sm border-b border-slate-50 pb-2">
                    <span class="font-bold text-slate-700">${sport}</span>
                    <div class="flex items-center gap-3">
                        <span class="text-[10px] font-black text-slate-300">${((data.wins/data.count)*100).toFixed(0)}% WIN</span>
                        <span class="font-black w-20 text-right ${data.profit >= 0 ? 'text-green-600' : 'text-red-600'}">
                            ${data.profit > 0 ? '+' : ''}${data.profit.toFixed(0)} Kč
                        </span>
                    </div>
                </div>
            `).join('');

            // Tabulka historie
            bets.forEach(bet => {
                const tr = document.createElement('tr');
                tr.className = "hover:bg-slate-50 transition-colors group";
                const netProfit = (bet.status !== 'loss' ? bet.winAmount : 0) - bet.stake;
                
                tr.innerHTML = `
                    <td class="px-6 py-4">
                        <div class="font-black text-slate-800 text-sm">${bet.sport}</div>
                        <div class="text-[10px] text-slate-400 font-bold">${bet.date}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm font-bold text-slate-700">${bet.stake.toFixed(2)} Kč</div>
                        <div class="text-[11px] text-blue-600 font-black uppercase">Kurz @${bet.odds}</div>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm font-black ${netProfit >= 0 ? 'text-green-600' : 'text-red-600'}">
                            ${netProfit >= 0 ? '+' : ''}${netProfit.toFixed(1)} Kč
                        </div>
                        <div class="text-[9px] uppercase tracking-widest text-slate-400 font-bold">
                            ${bet.status === 'cashout' ? 'Vyplaceno předčasně' : bet.status === 'loss' ? 'Prohra' : 'Zpracováno'}
                        </div>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <button onclick="deleteBet(${bet.id})" class="p-2 opacity-0 group-hover:opacity-100 text-slate-300 hover:text-red-500 transition-all">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(tr);
            });
            lucide.createIcons();
        }

        function showMsg(text) {
            const el = document.getElementById('msgBox');
            el.textContent = text;
            el.classList.replace('opacity-0', 'opacity-100');
            setTimeout(() => el.classList.replace('opacity-100', 'opacity-0'), 2500);
        }

        window.onload = init;
    </script>
</body>
</html>
